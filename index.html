<!DOCTYPE html>
<html>
  <head>
    <title>WebAR å»ºç¯‰ç‰©å‰æ’­æ”¾å½±ç‰‡</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js@1.7.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      #start-button,
      #play-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 30px;
        font-size: 18px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1000;
      }
    </style>
  </head>
  <body style="margin: 0; overflow: hidden">
    <button id="start-button">é»æ“Šå•Ÿå‹• WebAR</button>
    <button id="play-button" style="display: none">é»æ“Šæ’­æ”¾å½±ç‰‡</button>

    <!-- WebAR å ´æ™¯ -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-video
        id="ar-video"
        src="https://stupendous-fudge-84cc56.netlify.app/0317.mp4"
        position="0 2 -5"
        width="3"
        height="1.5"
        autoplay
        loop
        playsinline
        muted
        preload="auto"
      >
      </a-video>
      <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
      let isGPSSet = false;

      document
        .getElementById("start-button")
        .addEventListener("click", function () {
          enableGPS();
          document.getElementById("start-button").style.display = "none";
          document.getElementById("play-button").style.display = "block"; // é¡¯ç¤ºæ’­æ”¾æŒ‰éˆ•
        });

      document
        .getElementById("play-button")
        .addEventListener("click", function () {
          let video = document.getElementById("ar-video");
          video.play();
          this.style.display = "none"; // éš±è—æ’­æ”¾æŒ‰éˆ•
        });

      function enableGPS() {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              if (!isGPSSet) {
                let userLat = position.coords.latitude;
                let userLng = position.coords.longitude;

                console.log("ğŸ“ GPS è®€å–æˆåŠŸ:", userLat, userLng);

                let arVideo = document.getElementById("ar-video");
                arVideo.setAttribute(
                  "gps-entity-place",
                  `latitude: ${userLat}; longitude: ${userLng}`
                );

                isGPSSet = true;
              }
            },
            function (error) {
              console.error("âš ï¸ GPS ç„¡æ³•å•Ÿç”¨", error);
              alert("è«‹å…è¨± GPS å­˜å–ä»¥é¡¯ç¤º WebAR å½±ç‰‡ï¼");
            },
            { enableHighAccuracy: true, maximumAge: 30000, timeout: 5000 }
          );
        } else {
          alert("æ‚¨çš„è£ç½®ä¸æ”¯æ´ GPS");
        }
      }

      function checkAR() {
        let arVideo = document.getElementById("ar-video");
        if (arVideo) {
          console.log("âœ… WebAR å½±ç‰‡å·²è¼‰å…¥");
        } else {
          console.error("âŒ WebAR å½±ç‰‡æœªé¡¯ç¤º");
        }
      }

      window.onload = function () {
        checkAR();
        setTimeout(() => {
          enableGPS();
        }, 3000);
      };
    </script>
  </body>
</html>
