<!DOCTYPE html>
<html>
<head>
    <title>WebAR 建築物前播放影片</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/nicolocarpignoli/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA8tIJYmXx7fxn6ulAg-SMMC86oGgvSHFg"></script>

    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <!-- 顯示 Google 地圖 -->
    <div id="map"></div>

    <!-- WebAR 場景 -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <!-- AR 影片 (MP4) 漂浮在 GPS 位置 -->
        <a-video 
            id="ar-video"
            src="https://peppy-marshmallow-c47b19.netlify.app/0317.mp4"
            gps-entity-place="latitude: 24.969812026015507; longitude: 121.26015417116461"
            look-at="[gps-camera]"
            position="0 2 -5"
            width="3"
            height="1.5"
            autoplay
            loop>
        </a-video>

        <!-- GPS 相機 -->
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        function initMap() {
            var location = { lat: 24.969812026015507, lng: 121.26015417116461 };
            var map = new google.maps.Map(document.getElementById("map"), {
                zoom: 18,
                center: location,
            });
            var marker = new google.maps.Marker({
                position: location,
                map: map,
            });
        }
        window.onload = initMap;

        // **確保 GPS 位置正確啟動**
        function enableGPS() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        console.log("GPS 啟動成功:", position.coords.latitude, position.coords.longitude);
                    },
                    function (error) {
                        console.error("GPS 無法啟用", error);
                        alert("請允許 GPS 存取以顯示 AR 內容");
                    }
                );
            } else {
                alert("您的裝置不支援 GPS");
            }
        }

        // **確保 WebAR 正確顯示**
        function checkAR() {
            let arVideo = document.getElementById("ar-video");
            if (arVideo) {
                console.log("WebAR 影片已載入");
            } else {
                console.error("WebAR 影片未顯示");
            }
        }

        // **自動啟用 GPS & WebAR**
        setTimeout(() => {
            enableGPS();
            checkAR();
        }, 3000);
    </script>
</body>
</html>
